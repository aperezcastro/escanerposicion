<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>Mapa de mi casa - Pedómetro</title>
    <style>
        body { margin: 0; overflow: hidden; }
        canvas { display: block; }
        #info {
            position: absolute;
            top: 0;
            left: 0;
            background-color: rgba(255, 255, 255, 0.8);
            padding: 10px;
            font-family: Arial, sans-serif;
            font-size: 14px;
        }
    </style>
</head>
<body>
<div id="info">
    <h3>Datos en tiempo real</h3>
    <p>Pasos: <span id="steps">0</span></p>
    <p>Distancia: <span id="distance">0</span> metros</p>
</div>
<canvas id="canvas"></canvas>
<script>
    // Obtener el canvas y ajustar su tamaño
    let canvas = document.getElementById('canvas');
    let ctx = canvas.getContext('2d');
    let width = canvas.width = window.innerWidth;
    let height = canvas.height = window.innerHeight;
    
    // Variables de posición y escala
    let positions = [{ x: 0, y: 0 }];
    let x = 0, y = 0; // Posición en metros
    let scale = 50; // Escala para ajustar al canvas
    let offsetX = width / 2;
    let offsetY = height / 2;

    // Variables para el pedómetro
    let steps = 0;
    let distance = 0;
    let stepLength = 0.7; // Longitud promedio del paso en metros (ajusta según tu altura)
    let lastAcceleration = 0;
    let threshold = 1.2; // Umbral para detección de pasos

    // Elementos para mostrar los datos
    let stepsElem = document.getElementById('steps');
    let distanceElem = document.getElementById('distance');

    // Solicitar permiso para acceder a los sensores (iOS 13+)
    function requestPermissions() {
        if (typeof DeviceMotionEvent.requestPermission === 'function') {
            DeviceMotionEvent.requestPermission()
                .then(response => {
                    if (response == 'granted') {
                        window.addEventListener('devicemotion', handleMotion);
                    } else {
                        alert('Permiso denegado para acceder al acelerómetro.');
                    }
                })
                .catch(console.error);
        } else {
            window.addEventListener('devicemotion', handleMotion);
        }
    }

    requestPermissions();

    function handleMotion(event) {
        // Aceleración total
        let ax = event.accelerationIncludingGravity.x || 0;
        let ay = event.accelerationIncludingGravity.y || 0;
        let az = event.accelerationIncludingGravity.z || 0;

        // Magnitud de la aceleración
        let accMagnitude = Math.sqrt(ax * ax + ay * ay + az * az);

        // Detección de pasos sencilla
        if (accMagnitude - lastAcceleration > threshold) {
            steps++;
            distance = steps * stepLength;

            // Calcular la nueva posición (asumiendo movimiento en línea recta)
            x += stepLength * Math.cos(0); // Ángulo fijo, podrías actualizarlo si tienes orientación
            y += stepLength * Math.sin(0);

            positions.push({ x: x, y: y });

            // Actualizar los elementos HTML
            stepsElem.textContent = steps;
            distanceElem.textContent = distance.toFixed(2);
        }

        lastAcceleration = accMagnitude;

        // Limpiar el canvas
        ctx.clearRect(0, 0, width, height);

        // Dibujar la trayectoria
        ctx.beginPath();
        for (let i = 0; i < positions.length; i++) {
            let px = positions[i].x * scale + offsetX;
            let py = positions[i].y * scale + offsetY;
            if (i === 0) {
                ctx.moveTo(px, py);
            } else {
                ctx.lineTo(px, py);
            }
        }
        ctx.strokeStyle = 'blue';
        ctx.lineWidth = 2;
        ctx.stroke();
    }

</script>
</body>
</html>
